<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gi·∫£i c·ª©u h·ªçc sinh kh·ªèi t·ªß l·∫°nh</title>
<style>
body { margin:0; font-family: Arial, sans-serif; text-align:center; overflow:hidden; }
#startScreen, #endScreen {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: url('assets/background.png') no-repeat center/cover;
}
#gameScreen { display:none; background: url('assets/background.png') no-repeat center/cover; width:100%; height:100vh; position:relative; }
#fridgeContainer { position:relative;transform: scale(1.2); width:500px; height:400px; margin:20px auto; background:url('assets/fridge.png') no-repeat center/cover; }
.student { width:60px; height:60px; position:absolute; bottom:150px; transition: all 0.5s ease; }
#heatBar { width:300px; height:20px; border:2px solid #000; margin:10px auto; position:relative; }
#heatFill { height:100%; width:0%; background-color:#00ff00; transition: width 0.3s, background-color 0.3s; }
#codes { margin:10px; font-size:18px; color:#fff; text-shadow:1px 1px #000; }
.question { margin:20px; font-size:20px; color:#fff; text-shadow:1px 1px #000; }
.answers button { margin:5px; padding:10px 20px; font-size:16px; cursor:pointer; }
.frozen { filter: brightness(50%) grayscale(80%) blur(1px); }
#snowflake { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1000; }
.snow { position:absolute; width:10px; height:10px; background:white; border-radius:50%; opacity:0.8; animation:fall linear infinite; }
@keyframes fall { 0% { transform: translateY(-10px); } 100% { transform: translateY(100vh); } }
@keyframes shake { 0% { transform: translateX(0px); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0px); } }
@keyframes jump { 0% { bottom:50px; } 50% { bottom:150px; } 100% { bottom:50px; } }
</style>
</head>
<body>

<!-- Start Screen -->
<div id="startScreen">
    <h1>Gi·∫£i c·ª©u h·ªçc sinh kh·ªèi t·ªß l·∫°nh!</h1>
    <p>C√°ch ch∆°i: Tr·∫£ l·ªùi ƒë√∫ng ƒë·ªÉ nh·∫≠n code m·ªü c·ª≠a. Tr·∫£ l·ªùi sai ‚Üí nhi·ªát tƒÉng, h·ªçc sinh run s·ª£, tuy·∫øt r∆°i nhi·ªÅu. Sai qu√° nhi·ªÅu s·∫Ω ƒë√≥ng bƒÉng!</p>
    <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
</div>
<!-- Ice Overlay -->
<div id="iceOverlay" style="
    position:absolute;
    top:0; left:0;
    width:80px; height:100%;
    pointer-events:none;
    background:url('assets/ice.png') no-repeat right/cover;
    z-index:50;
    opacity:0.8;
    filter: blur(2px);
    transition: width 1s linear;
"></div>
<!-- Game Screen -->
<div id="gameScreen">
    <div id="fridgeContainer">
        <img src="assets/student1.png" id="student1" class="student" style="left:103px;">
        <img src="assets/student2.png" id="student2" class="student" style="left:162px;">
        <img src="assets/student3.png" id="student3" class="student" style="left:224px;">
        <img src="assets/student4.png" id="student4" class="student" style="left:283px;">
        <img src="assets/student5.png" id="student5" class="student" style="left:337px;">
    </div>
    <div id="heatBar"><div id="heatFill"></div></div>
    <div id="codes">S·ªë code ƒë√£ thu th·∫≠p: 0/5</div>
    <div class="question" id="question"></div>
    <div class="answers" id="answers"></div>
    <div id="timer">Th·ªùi gian c√≤n l·∫°i: <span id="time">10</span>s</div>
</div>

<!-- Snow effect -->
<div id="snowflake"></div>

<!-- End Screen -->
<div id="endScreen" style="display:none;">
    <h1 id="endMessage"></h1>
    <button onclick="location.reload()">Ch∆°i l·∫°i</button>
</div>

<!-- Sounds -->
<audio id="tick" src="assets/tick.mp3"></audio>
<audio id="success" src="assets/success.mp3"></audio>
<audio id="fail" src="assets/fail.mp3"></audio>
<audio id="openDoor" src="assets/openDoor.mp3"></audio>
<audio id="bgm" src="assets/bgm.mp3" loop></audio>
<audio id="winSound" src="assets/win.mp3"></audio>
<audio id="loseSound" src="assets/lose.mp3"></audio>

<script>
// Questions
const questions = [
    {q:"Th·ª©c ƒÉn ch∆∞a s·ª≠ d·ª•ng xong n√™n l√†m g√¨?", a:["ƒê·ªï v√†o th√πng r√°c","C·∫•t v√†o t·ªß l·∫°nh","V·ª©t ra ngo√†i ƒë∆∞·ªùng","ƒê·ªï xu·ªëng c·ªëng"], correct:1},
    {q:"T·ªß l·∫°nh c√≥ ch·ª©c nƒÉng ch√≠nh l√† g√¨?", a:["B·∫£o qu·∫£n th·ª±c ph·∫©m","L√†m kem","S·∫•y kh√¥ ƒë·ªì","L√†m n√≥ng th·ª±c ph·∫©m"], correct:0},
    {q:"T·ªß l·∫°nh th∆∞·ªùng c√≥ m·∫•y ngƒÉn?", a:["Kh√¥ng c√≥","M·ªôt","Hai","Ba"], correct:2},
    {q:"T·∫°i sao kh√¥ng n√™n m·ªü c·ª≠a t·ªß l·∫°nh l√¢u?", a:["T·ªën ƒëi·ªán","L√†m h∆∞ ngay","Kh√¥ng ·∫£nh h∆∞·ªüng","G√¢y ti·∫øng ·ªìn"], correct:0},
    {q:"Kem b·∫£o qu·∫£n ·ªü ngƒÉn n√†o?", a:["NgƒÉn rau","NgƒÉn ƒë√°","NgƒÉn l√†m l·∫°nh","C·ª≠a t·ªß"], correct:1}
];

let currentQ=0, heat=0, codes=0, wrongCount=0, timeLeft=10, timer;
let snowInterval; // ƒë·ªÉ snow r∆°i li√™n t·ª•c khi sai

function startGame(){
    document.getElementById('startScreen').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    document.getElementById('bgm').play();
    showQuestion();
}

function showQuestion(){
    if(currentQ>=questions.length){ endGame(); return; }
    const q=questions[currentQ];
    document.getElementById('question').innerText=q.q;
    const ansDiv=document.getElementById('answers'); ansDiv.innerHTML='';
    q.a.forEach((ans,idx)=>{
        const btn=document.createElement('button'); btn.innerText=ans;
        btn.onclick=()=> selectAnswer(idx); ansDiv.appendChild(btn);
    });
    startTimer();
}

function startTimer() {
    timeLeft = 10;
    document.getElementById('time').innerText = timeLeft;

    const tickSound = document.getElementById('tick');

    // N·∫øu ch∆∞a sai ƒë·ªß 3 th√¨ m·ªõi b·∫≠t √¢m tick
    if (wrongCount < 3) {
        tickSound.currentTime = 0;
        tickSound.play();
    }

    timer = setInterval(() => {
        timeLeft--;
        document.getElementById('time').innerText = timeLeft;

        if (wrongCount >= 3) {
            // T·∫Øt √¢m v√† d·ª´ng lu√¥n timer
            tickSound.pause();
            tickSound.currentTime = 0;
            clearInterval(timer);
            return;
        }

        if (timeLeft <= 0) {
            clearInterval(timer);
            selectAnswer(-1);
        }

    }, 1000);
}


function selectAnswer(idx){
    clearInterval(timer);
    const q=questions[currentQ];
    if(idx===q.correct){ 
        codes++; document.getElementById('codes').innerText=`S·ªë code ƒë√£ thu th·∫≠p: ${codes}/5`; 
        animateStudent(true); document.getElementById('success').play(); 
    }else{ 
        wrongCount++; 
        handleWrong();
    }
    currentQ++; setTimeout(showQuestion,1000);
}

function handleWrong(){
    heat++; updateHeatBar(); animateStudent(false); document.getElementById('fail').play();
    if(!snowInterval){ startSnow(); } // start snow n·∫øu ch∆∞a
    if(heat>=3) endGame();
}

function updateHeatBar(){
    const fill=document.getElementById('heatFill'); let percent=(heat/3)*100;
    fill.style.width=percent+'%';
    if(percent<50) fill.style.backgroundColor='#00ff00';
    else if(percent<100) fill.style.backgroundColor='#ffff00';
    else fill.style.backgroundColor='#ff0000';
    if(heat>=3){
        document.querySelectorAll('.student').forEach(s=>s.classList.add('frozen'));
    }
}

function animateStudent(correct){
    const students = [...document.querySelectorAll('.student')];
    if(correct){
        // Ch·ªâ h·ªçc sinh hi·ªán t·∫°i nh·∫£y ra
        const stu = students[codes - 1];
        stu.style.animation='jump 0.6s ease'; 
        setTimeout(()=>stu.style.bottom='400px',500);
        setTimeout(()=>stu.style.display='none',800);
        document.getElementById('success').play();
    } else {
        // T·∫•t c·∫£ h·ªçc sinh rung l·∫Øc
        students.forEach(stu => {
            stu.style.animation='shake 0.5s';
        });
        setTimeout(()=>students.forEach(stu => stu.style.animation=''),500);
        document.getElementById('fail').play();
    }
}

// Snow effect d·ª±a tr√™n s·ªë l·∫ßn sai
function startSnow(){
    const snowflake=document.getElementById('snowflake');
    snowInterval=setInterval(()=>{
        const snow=document.createElement('div');
        snow.classList.add('snow');
        snow.style.left=Math.random()*100+'%';
        snow.style.animationDuration=(2+Math.random()*3)+'s';
        snowflake.appendChild(snow);
        setTimeout(()=>snow.remove(),5000);
    }, wrongCount*100); // sai nhi·ªÅu r∆°i nhanh h∆°n
}

function endGame() {
    clearInterval(timer);
    clearInterval(snowInterval);

    document.getElementById('gameScreen').style.display = 'none';
    document.getElementById('endScreen').style.display = 'flex';

    const msg = document.getElementById('endMessage');

    if (codes >= 5) {
        msg.innerText = "üéâ Ch√∫c m·ª´ng! H·ªçc sinh ƒë∆∞·ª£c gi·∫£i c·ª©u!";
        document.getElementById('openDoor').play();
        document.getElementById('winSound').play();  // üîä √¢m th·∫Øng
    } else {
        msg.innerText = "‚ùÑÔ∏è Oh no! H·ªçc sinh b·ªã ƒë√≥ng bƒÉng!";
        document.getElementById('loseSound').play(); // üîä √¢m thua
    }

    document.getElementById('bgm').pause();
}

function handleWrong(){
    heat++; updateHeatBar(); document.getElementById('fail').play();
    
    // T·∫•t c·∫£ h·ªçc sinh rung l·∫Øc
    document.querySelectorAll('.student').forEach(stu=>{
        stu.style.animation='shake 0.5s';
        setTimeout(()=>stu.style.animation='',500);
    });

    // Hi·ªáu ·ª©ng tuy·∫øt
    if(!snowInterval){ startSnow(); }

    // Hi·ªáu ·ª©ng ƒë√≥ng bƒÉng t·ª´ng h·ªçc sinh t·ª´ ph·∫£i sang tr√°i
    animateFreezePerStudent();
    
    if(heat>=3) endGame();
}

// ƒê√≥ng bƒÉng t·ª´ng h·ªçc sinh
let freezeIndex = 4; // b·∫Øt ƒë·∫ßu t·ª´ student5 (index 4)
function animateFreezePerStudent(){
    const students = [...document.querySelectorAll('.student')];
    if(freezeIndex < 0) return; // t·∫•t c·∫£ ƒë√£ b·ªã ƒë√≥ng bƒÉng
    const stu = students[freezeIndex];

    // T·∫°o l·ªõp ice tr·ª±c ti·∫øp ph·ªß l√™n student
    const ice = document.createElement('div');
    ice.style.position='absolute';
    ice.style.top=stu.offsetTop+'px';
    ice.style.left=stu.offsetLeft+'px';
    ice.style.width = '78px'; // r·ªông h∆°n h·ªçc sinh m·ªôt ch√∫t
    ice.style.height=stu.offsetHeight+'px';
    ice.style.background="url('assets/ice.png') no-repeat center/cover";
    ice.style.opacity='0.9';
    ice.style.filter='blur(0px)';
    ice.style.zIndex='100';
    ice.style.transition='all 1s linear';
    document.getElementById('fridgeContainer').appendChild(ice);

    freezeIndex--; // l·∫ßn sau s·∫Ω ph·ªß h·ªçc sinh b√™n tr√°i
}


// Khi user reload d√πng n√∫t "Ch∆°i l·∫°i" tr√™n end screen -> location.reload() ƒë√£ g√°n s·∫µn


</script>

</body>
</html>
